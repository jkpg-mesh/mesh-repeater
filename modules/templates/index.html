<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mesh-Repeater WebUI</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='webui.css') }}">
</head>
<body>
    <div class="container">
        <h1>ğŸ“¡ Node Status</h1>
        
        {% if info and info.user %}
            <ul class="info-list">
                <li><strong>Node ID:</strong> <span>{{ info.user.id }}</span></li>
                <li><strong>Long Name:</strong> <span>{{ info.user.longName }}</span></li>
                <li><strong>Short Name:</strong> <span>{{ info.user.shortName }}</span></li>
                <li><strong>Hardware Model:</strong> <span>{{ info.user.hwModel }}</span></li>
                <li><strong>Channel Utilization:</strong> <span>{{ info.deviceMetrics.channelUtilization | round(2) }}</span></li>
                <li><strong>Air Utilization TX:</strong> <span>{{ info.deviceMetrics.airUtilTx | round(2) }}</span></li>
                <li><strong>Uptime (hours):</strong> <span>{{ (info.deviceMetrics.uptimeSeconds / 3600) | round(2) }}</span></li>
                <li><strong>Temp AHT20:</strong> <span>{{ METdata.temp1|round(0, 'common') }} Â°C</span></li>
                <li><strong>Temp BMP280:</strong> <span>{{ METdata.temp2|round(0, 'common') }} Â°C</span></li>
                <li><strong>Humidity AHT20:</strong> <span>{{ METdata.humidity|round(0, 'common') }} %</span></li>
                <li><strong>Pressure Station BMP280:</strong> <span>{{ METdata.pressure_station|round(1, 'common') }} hPa</span></li>
                <li><strong>Pressure Sea BMP280:</strong> <span>{{ METdata.pressure_sea|round(1, 'common') }} hPa</span></li>
            </ul>
        {% else %}
            <p>Could not retrieve node information.</p>
        {% endif %}

        <!-- Countdown Timer -->
        {% if broadcast == "Enabled" %}
            <div id="countdownBox" class="countdown {% if emergency == "Enabled" %}emergency{% endif %}">
                {% if emergency == "Enabled" %}
                    ğŸš¨ Emergency broadcast in <span id="countdown">{{ reload_seconds }}</span> seconds
                {% else %}
                    ğŸ”Š Next message broadcast in <span id="countdown">{{ reload_seconds }}</span> seconds
                {% endif %}
            </div>
        {% endif %}

        <div class="nav-container">
            <a href="{{ url_for('setup') }}" class="nav-link">Setup âš™ï¸</a>
            <a href="{{ url_for('nodes') }}" class="nav-link">Nodes ğŸ§­</a>
            <a href="{{ url_for('activity') }}" class="nav-link">Activity ğŸ“Š</a>
            <a href="{{ url_for('logfile') }}" class="nav-link">Log Files ğŸ“</a>
            <a href="{{ url_for('weather') }}" class="nav-link">Weather ğŸŒ¤ï¸</a>
        </div>
    </div>

    {% if broadcast == "Enabled" %}
    <script>
        const countdownElement = document.getElementById("countdown");
        let seconds = parseInt(countdownElement.textContent);

        // Calculate the target end time
        const endTime = Date.now() + seconds * 1000;

        function updateCountdown() {
            const remaining = Math.round((endTime - Date.now()) / 1000);
            countdownElement.textContent = remaining > 0 ? remaining : 0;

            if (remaining <= 0) {
                location.reload();
            } else {
                requestAnimationFrame(updateCountdown);
            }
        }

        // Start the countdown
        updateCountdown();
    </script>

    {% endif %}
</body>
</html>